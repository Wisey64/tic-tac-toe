<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>tic tac toe</h1>
    
    <button class="open">Start The Game!</button>
    <dialog class="modal">
        <form action="" class="modal-form">
            <label for="name">Player Name</label>
            <input type="text" name="name" id="name" required>
            <p class="radiopara">Please select your marker:</p>
            <div class="radio-container">
                <input type="radio" name="marker" id="markerx" value="X" required>
                <label for="markerx" class="X">X</label>
                <input type="radio" name="marker" id="markero" value="O" required>
                <label for="markero" class="O">O</label>
            </div>
            <button class="submit" type="submit">Start</button>
        </form>
    </dialog>
    
    <div class="game-info">
        <div class="status">
        </div>
        
    </div>
    

    
    <script>
    const openbtn=document.querySelector(".open")
    const modal=document.querySelector(".modal")
    const statusDiv = document.querySelector(".status");
    const gameinfo = document.querySelector(".game-info")
    const updateStatus = (message) => {
    statusDiv.textContent = message;
};


    openbtn.addEventListener("click",() => {
        modal.showModal()
    })

            let gameOver = false;
            const Gameboard= (() => {
                const board=["","","","","","","","",""]
                const submitbtn = document.querySelector(".submit");
submitbtn.addEventListener("click", (event) => {
    event.preventDefault(); // Prevent the default form submission behavior

    // Get player input and marker
    const pname = document.getElementById("name").value.trim();
    const selectedRadio = document.querySelector('input[name="marker"]:checked');

    // Form validation
    if (!pname || !selectedRadio) {
        alert("Please fill out your name and select a marker!");
        return; // Stop execution if the form is invalid
    }

    const choosenmarker = selectedRadio.value;
    const player = createPlayer(pname);
    player.chooseMarker(choosenmarker);

    // Create game board container
    const newdiv = document.createElement("div");
    newdiv.classList.add("container");

    document.body.appendChild(newdiv);
    document.body.removeChild(openbtn);

    board.forEach((_, index) => {
        const gcell = document.createElement("div");
        gcell.classList.add("gcell");
        gcell.dataset.index = index; // Store the index for identification
        newdiv.appendChild(gcell);

        // Add event listener to each cell
        gcell.addEventListener("click", () => {
            if (!gameOver && Gameboard.getboard()[index] === "") {
                playTurn(index); // Pass the cell index to playTurn
            } else {
                console.log("Invalid move or game over.");
            }
        });
    });

    modal.close();

    // Create and handle restart button
    const restartButton = document.createElement("button");
    restartButton.textContent = "Restart Game";
    restartButton.classList.add("restart", "open");
    gameinfo.appendChild(restartButton);

    restartButton.addEventListener("click", () => {
        Gameboard.reset();
        gameOver = false;
        turns.randomizeFirstTurn();
        updateStatus(""); // Clear the status message
        console.log("Game reset. Starting new game...");

        // Clear the UI board
        const cells = document.querySelectorAll(".gcell");
        cells.forEach(cell => {
            cell.textContent = "";
        });
    });

});

// Open the modal when the open button is clicked
document.querySelector('.open').addEventListener('click', () => {
    modal.showModal();
});

                
                
                const update= (index,marker) => {
                    console.log(`Attempting to update index ${index} with marker ${marker}`);
                    if (index >= 0 && index < board.length && board[index] === "") {
                        
                        
                        board[index] = marker;
                        console.log(`Board updated: ${board}`);
                    } else { 
        console.log("Invalid move or spot already taken.");
    }
                };
                const reset = () => {
                    for (let i = 0;i<board.length;i++){
                        board[i] = ""
                    }
                };
                const getboard=() => [...board]
                return {update, reset,getboard}
            })();
            
            function createPlayer(playername){
                const player =playername
                let marker =""
                const chooseMarker=(newmarker) => { 
                    
                    
                    if (newmarker==="X" || newmarker==="O") {
                        marker = newmarker;
                        return `Marker set to ${newmarker}`;
                    } else {
                        console.log("Invalid marker! Please choose 'X' or 'O'.");
                    }
                    
                }
                const getInfo = () => ({player, marker});
                return {chooseMarker, player,getInfo}
            }
            //to help visualize the game in the console
            const printBoard = () => {
                const board = Gameboard.getboard();

                for (let i = 0; i < 3; i++) {
                console.log(board.slice(i * 3, (i + 1) * 3).join(" | "));
                if (i < 2) console.log("---------");
                }
            };

           const checkWinner= () => {
            const board = Gameboard.getboard();
            const winningCombo = [
                [0,1,2],[3,4,5],[6,7,8], //rows
                [0,3,6],[1,4,7],[2,5,8], //columns
                [0,4,8],[2,4,6], // diagonals
           ];
           for(let combo of winningCombo) {
            const [a, b ,c] = combo;
            if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                gameOver = true
                return board[a]
            }
           }            
           return null; 
           }
           const checkTie = () => {
    const board = Gameboard.getboard();
    // If all spots are filled and no winner, it's a tie
    if (board.every(spot => spot !== "") && !checkWinner()) {
        gameOver = true;
        return true; // 
    }
    return false;
};

           const turns = (() => {
    let currentMarker = "";

    const randomizeFirstTurn = () => {
        currentMarker = Math.random() < 0.5 ? "X" : "O";
        return currentMarker;
    };

    const switchTurn = () => {
        currentMarker = currentMarker === "X" ? "O" : "X";
        return currentMarker;
    };

    const getCurrentMarker = () => currentMarker;

    return { randomizeFirstTurn, switchTurn, getCurrentMarker };
})();

// Randomize the first turn when the game starts
turns.randomizeFirstTurn();
console.log(`First turn: ${turns.getCurrentMarker()}`);

const playTurn = (index) => {
    if (gameOver) {
        console.log("Game is over! Restart to play again.");
        return;
    }

    const currentMarker = turns.getCurrentMarker();
    console.log(`Attempting to play turn for marker ${currentMarker} at index ${index}`);

    // Check if the move is valid
    const boardBeforeUpdate = Gameboard.getboard();
    if (boardBeforeUpdate[index] !== "") {
        console.log("Invalid move, spot already taken.");
        return; // Exit early if the move is invalid
    }

    // Update the game state (logic layer)
    Gameboard.update(index, currentMarker);

    // Synchronize the UI (visual layer)
    const gcell = document.querySelector(`.gcell[data-index="${index}"]`);
    if (gcell) {
        gcell.textContent = currentMarker; // Set the marker on the board
    }

    // Check for a winner or tie
    const winner = checkWinner();
    if (winner) {
        console.log(`${currentMarker} wins!`);
        printBoard();
        gameOver = true;
        updateStatus(`${currentMarker} won!`);
        return;
    }

    if (checkTie()) {
        console.log("It's a tie!");
        printBoard();
        gameOver = true;
        updateStatus("It's a tie!");
        return;
    }

    // Switch the turn after a valid move
    turns.switchTurn();
    console.log(`Next turn: ${turns.getCurrentMarker()}`);
};




const resetGame = () => {
    Gameboard.reset();
    gameOver = false;
    turns.randomizeFirstTurn();
    console.log("Game reset. Starting new game...");
    printBoard();
};
//form validation
const form = document.querySelector('.modal-form');

form.addEventListener('submit', (event) => {
    const nameInput = document.getElementById('name');
    const selectedMarker = document.querySelector('input[name="marker"]:checked');

    if (!nameInput.value || !selectedMarker) {
        event.preventDefault(); // Prevent the form from closing
        alert("Please fill out your name and select a marker!");
    } else {
        modal.close(); // Close the modal only if the form is valid
    }
});


document.querySelector('.open').addEventListener('click', () => {
    modal.showModal();
});



  

          

   
         
        

    </script>
</body>
</html>